@page "/propertyownerlist"

@using System.Text
@using DominateDocsData.Models
@using DominateDocsData.Enums
@using System.Globalization

@rendermode InteractiveServer
@inject PropertyOwnerViewModel viewModel
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar
@inject UserSession Session

<MudGrid Class="mb-10">

    @if (!AddEdit)
    {        
            <MudItem xs="12" md="12">
                <MudTable Context="context" Items="viewModel.RecordList" Hover="true" Bordered="true" Dense="true" @bind-SelectedItem="viewModel.SelectedRecord" RowClick="OnSelectedRecord">
                    <ToolBarContent>
                        <MudTextField @bind-Value="_search" Placeholder="Search..." />
                    </ToolBarContent>
                    <HeaderContent>
                        <MudTh>Entity Name</MudTh>
                        <MudTh>Address</MudTh>
                        <MudTh>Phone</MudTh>
                        <MudTh>Email</MudTh>
                        <MudTh>

                        </MudTh>
                        <MudTh>
                           <MudButton Class="rounded-4"
                                   Disabled="@AddButtonDisabled"
                                   Variant="Variant.Text"
                                   Size="Size.Small"
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.Add"
                                   OnClick="AddButton">
                                Add Property Owner
                           </MudButton>
                        </MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Enitity Name">@context.EntityName</MudTd>
                        <MudTd DataLabel="Address">@context.FullAddress</MudTd>
                        <MudTd DataLabel="Phone">@context.ContactPhoneNumber</MudTd>
                        <MudTd DataLabel="Email">@context.ContactEmail</MudTd>
                        <MudTd DataLabel="Active">
                            <MudChip T="bool" Color="@((context.IsActive) ? Color.Success : Color.Error)">
                                @(context.IsActive ? "Yes" : "No")
                            </MudChip>
                        </MudTd>
                        <MudTd>
                            <MudButton Variant="Variant.Text"
                                       Size="Size.Small"
                                       Color="Color.Info"
                                       StartIcon="@Icons.Material.Filled.Edit"
                                       OnClick="@(() => OnSelectedRecord(context))">
                                Edit
                            </MudButton>

                            <MudButton Variant="Variant.Text"
                                       Size="Size.Small"
                                       Color="Color.Error"
                                       StartIcon="@Icons.Material.Filled.Delete"
                                       OnClick="@(() => OnDeleteRecord(context))">
                                Delete
                            </MudButton> 
                        </MudTd>
                    </RowTemplate>
                <NoRecordsContent>
                    <MudText Color="Color.Secondary" Class="pa-4">
                        🚫 No Active Property Owners Found. Please add!
                    </MudText>
                </NoRecordsContent>
                </MudTable>
            </MudItem>
       
    }
    else
    {
        <MudItem xs="12" md="12">
            <MudPaper Elevation="1" Class="mt-5" Style="background-color: #F2F2F2;">

                <br />

                <MudText Class="pl-4 mt-5" Typo="Typo.h5">Property Owner</MudText>

                <PropertyOwner />

            </MudPaper>

        </MudItem>
    }
</MudGrid>





@code
{
    private bool AddEdit = false;



    private bool AddButtonDisabled = false;

    private string _search = "";

    protected override async Task OnInitializedAsync()
    {
        viewModel.InitializePageCommand.Execute(null);
        
    }

    private void AddButton()
    {
        viewModel.GetNewRecordCommand.Execute(null);

        AddEdit = true;
        AddButtonDisabled = true;


    }

    private void OnDeleteRecord(DominateDocsData.Models.PropertyOwner r)
    {
        if (r is not null) viewModel.DeleteRecordCommand.Execute(r);

        AddEdit = false;
    }

    private void OnSelectedRecord(DominateDocsData.Models.PropertyOwner r)
    {
        if (r is not null) viewModel.SelectRecordCommand.Execute(r);

        AddEdit = true;
    }

    private async Task OnEntityOwnerComplete(List<DominateDocsData.Models.EntityOwner> entityOwners)
    {
        viewModel.EditingRecord.EntityOwners = entityOwners;
    }

    private async Task OnEntityOwnerCanceled()
    {
        StateHasChanged();
    }
}